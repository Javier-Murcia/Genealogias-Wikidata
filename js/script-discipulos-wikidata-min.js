let titulo="";SelectPersonaje2="",LimitMax=200,Iteraciones=15,botonActivo=!1;const Seleccion=document.getElementById("descen-progenitores").value;Select="",Select="Descendientes"==Seleccion?"Forward":"Reverse";const headers={Accept:"application/sparql-results+json"};function Comenzar(){const e=document.getElementById("maximoResultados").value,t=document.getElementById("maxIterations").value;Select="Forward",SelectPersonaje="Q762",Inicial=!0,fectDatos(e,t,Select,SelectPersonaje)}function fectDatos(e,t,n,a){return fetch("https://query.wikidata.org/sparql?query="+encodeURIComponent(`PREFIX gas: <http://www.bigdata.com/rdf/gas#>\nSELECT ?item ?itemLabel ?linkTo ?depth ?comment (SAMPLE (?EjemfechaNaci) AS ?fechaNaci) (SAMPLE (?pic) AS ?unica_pic)\nWHERE\n{\n  SERVICE gas:service {\n    gas:program gas:gasClass "com.bigdata.rdf.graph.analytics.SSSP" ;\n                gas:in wd:${a} ;\n                gas:traversalDirection "${n}" ;\n                gas:out ?item ;\n                gas:out1 ?depth ;\n                gas:maxIterations ${t} ;\n                gas:linkType wdt:P802 ;\n              #  gas:linkType1 wdt:P22 .\n  }\n  OPTIONAL { ?item wdt:P802 ?linkTo.}\n   #  OPTIONAL { ?item wdt:P22 ?linkTo1 }\n   OPTIONAL { ?item wdt:P18 ?pic.}\nOPTIONAL { ?item wdt:P569 ?EjemfechaNaci }\nOPTIONAL { ?item schema:description ?comment.\n             FILTER (lang(?comment) = 'es').}\n  SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],es,en,ca,ms,be,ar,bg,bn,cs,da,de,el,fr,et,fa,fi,he,hi,hu,hy,id,it,ja,jv,ko,nb,nl,eo,pa,pl,pt,ro,ru,sh,sk,sr,sv,sw,te,th,tr,uk,yue,vec,vi,zh". }\n}GROUP BY ?item ?itemLabel ?linkTo ?unica_pic ?depth ?comment ?fechaNaci\nORDER BY ?depth\nLIMIT ${e}`),{headers:headers}).then((e=>e.json())).then((e=>mostrarDatos(e)))}function errorFunction(){document.getElementById("div").innerHTML="No hemos encontrado lo que buscabas, prueba otra palabra"}function mostrarDatos(e){document.getElementById("supDerecha").innerHTML="";if(document.getElementById("timeline").innerHTML="",null==e.results.bindings[0]){document.getElementById("div").innerHTML="No hemos encontrado lo que buscabas, prueba otra palabra"}const t=document.getElementById("descen-progenitores").value;if("Descendientes"==t){document.getElementById("titulo").textContent="Discípulos de "+e.results.bindings[0].itemLabel.value}if("Progenitores"==t){document.getElementById("titulo").textContent="Maestros de "+e.results.bindings[0].itemLabel.value}function n(e){return e=(e=(e=e.replace(/^(?![+-])/,"+")).replace(/^([+-]?)(\d{1,5}\b)/,(function(e,t,n){return t+("00000"+n).slice(-6)}))).replace(/Z$/,"")}nodes=[],e.results.bindings.forEach(((e,t)=>{e.unica_pic&&e.comment?nodes.push({id:e.item.value,label:e.itemLabel.value,color:"#fcf3f2",shape:"circularImage",image:e.unica_pic.value.replace("File:","Special:FilePath/")+"?width=100",title:e.comment.value+"  -Doble click para seleccionar este personaje-"}):e.unica_pic?nodes.push({id:e.item.value,label:e.itemLabel.value,color:"#fcf3f2",shape:"circularImage",image:e.unica_pic.value.replace("File:","Special:FilePath/")+"?width=100",title:e.itemLabel.value+"  -Doble click para seleccionar este personaje-"}):e.comment?nodes.push({id:e.item.value,label:e.itemLabel.value,color:"#fcf3f2",title:e.comment.value+"  -Doble click para seleccionar este personaje-"}):nodes.push({id:e.item.value,label:e.itemLabel.value,color:"#fcf3f2",title:e.itemLabel.value+"  -Doble click para seleccionar este personaje-"})}));let a=new Set(nodes.map(JSON.stringify)),o=Array.from(a).map(JSON.parse);i=[],e.results.bindings.forEach(((e,t)=>{e.linkTo&&i.push({from:e.item.value,to:e.linkTo.value,color:"#949191",arrows:"to",label:"Discípulo"})}));var i=new vis.DataSet(i),c=document.getElementById("mynetwork"),l={nodes:o,edges:i},s={edges:{arrows:{to:{scaleFactor:.6}}},layout:{hierarchical:{direction:directionInput.value,enabled:jerarquia,levelSeparation:250,nodeSpacing:100,treeSpacing:200,blockShifting:!0,edgeMinimization:!0,parentCentralization:!0,sortMethod:"directed",shakeTowards:"leaves"}},nodes:{shape:"ellipse"}};new vis.Network(c,l,s).on("doubleClick",(function(e){const t=document.getElementById("descen-progenitores").value,n=document.getElementById("maximoResultados").value,a=document.getElementById("maxIterations").value;Select="",Inicial=!1,Select="Descendientes"==t?"Forward":"Reverse",SelectPersonaje2="",fectDatos(n,a,Select,e.nodes[0].slice(31)),SelectPersonaje2=e.nodes[0].slice(31),botonActivo=!1})),items2=[],e.results.bindings.forEach(((e,t)=>{e.fechaNaci&&"http"===e.fechaNaci.value.slice(0,4)||(e.unica_pic&&e.fechaNaci?items2.push({id:e.item.value,content:e.itemLabel.value+'</br><img src="'+e.unica_pic.value.replace("File:","Special:FilePath/")+'?width=50"/></br>'+e.fechaNaci.value.slice(0,5).replace(/[^0-9]$/,""),start:n(e.fechaNaci.value)}):e.fechaNaci&&items2.push({id:e.item.value,content:e.itemLabel.value+"</br>"+e.fechaNaci.value.slice(0,5).replace(/[^0-9]$/,""),start:n(e.fechaNaci.value)}))}));let r=new Set(items2.map(JSON.stringify));montar(Array.from(r).map(JSON.parse),s={minHeight:"400px",maxHeight:"500px",orientation:{axis:"both",item:"top"},align:"auto",stack:!0})}function montar(e,t){var n=document.getElementById("timeline");new vis.Timeline(n,e,t)}document.getElementById("botonBusqueda").addEventListener("click",(()=>{const e=document.getElementById("maximoResultados").value,t=document.getElementById("maxIterations").value,n=document.getElementById("descen-progenitores").value;document.getElementById("supDerecha").innerHTML="¡Estamos buscando!";let a="";Inicial=!1,botonActivo=!0,a="Descendientes"==n?"Forward":"Reverse";const o=document.getElementById("tipos").value;let i=SelectPersonaje2;i="Leonardo_da_Vinci"==o?"Q762":"Aristóteles"==o?"Q868":"Nicolás_Copérnico"==o?"Q619":"Juan_Argirópulo"==o?"Q26648":"Jean_Auguste_Dominique_Ingres"==o?"Q23380":SelectPersonaje2,i&&fectDatos(e,t,a,i),document.getElementById("nombreEntrada").value=i}));var directionInput=document.getElementById("direction"),btnUD=document.getElementById("btn-UD");btnUD.onclick=function(){directionInput.value="UD",jerarquia=!0;SelectPersonaje2;const e=document.getElementById("maximoResultados").value,t=document.getElementById("maxIterations").value;let n="";if(n="Descendientes"==document.getElementById("descen-progenitores").value?"Forward":"Reverse",1==botonActivo){fectDatos(e,t,n,document.getElementById("nombreEntrada").value)}else if(0==botonActivo){fectDatos(e,t,n,SelectPersonaje2)}if(1==Inicial){fectDatos(e,t,n,"Q762")}};var btnDU=document.getElementById("btn-DU");btnDU.onclick=function(){directionInput.value="DU",jerarquia=!0;SelectPersonaje2;const e=document.getElementById("maximoResultados").value,t=document.getElementById("maxIterations").value;let n="";if(n="Descendientes"==document.getElementById("descen-progenitores").value?"Forward":"Reverse",1==botonActivo){fectDatos(e,t,n,document.getElementById("nombreEntrada").value)}else if(0==botonActivo){fectDatos(e,t,n,SelectPersonaje2)}if(1==Inicial){fectDatos(e,t,n,"Q762")}};const enfermedadActiva="";var btnLR=document.getElementById("btn-LR");btnLR.onclick=function(){directionInput.value="LR",jerarquia=!0;SelectPersonaje2;const e=document.getElementById("maximoResultados").value,t=document.getElementById("maxIterations").value;let n="";if(n="Descendientes"==document.getElementById("descen-progenitores").value?"Forward":"Reverse",1==botonActivo){fectDatos(e,t,n,document.getElementById("nombreEntrada").value)}else if(0==botonActivo){fectDatos(e,t,n,SelectPersonaje2)}if(1==Inicial){fectDatos(e,t,n,"Q762")}};var btnRL=document.getElementById("btn-RL");btnRL.onclick=function(){directionInput.value="RL",jerarquia=!0;SelectPersonaje2;const e=document.getElementById("maximoResultados").value,t=document.getElementById("maxIterations").value;document.getElementById("descen-progenitores").value;let n="";if(n="Descendientes"==document.getElementById("descen-progenitores").value?"Forward":"Reverse",1==botonActivo){fectDatos(e,t,n,document.getElementById("nombreEntrada").value)}else if(0==botonActivo){fectDatos(e,t,n,SelectPersonaje2)}if(1==Inicial){fectDatos(e,t,n,"Q762")}};var jerarquia=!0;directionInput.value="UD";var btnJER=document.getElementById("btn-Jerarq");btnJER.onclick=function(){jerarquia=!1;SelectPersonaje2;const e=document.getElementById("maximoResultados").value,t=document.getElementById("maxIterations").value;let n="";if(n="Descendientes"==document.getElementById("descen-progenitores").value?"Forward":"Reverse",1==botonActivo){fectDatos(e,t,n,document.getElementById("nombreEntrada").value)}else if(0==botonActivo){fectDatos(e,t,n,SelectPersonaje2)}if(1==Inicial){fectDatos(e,t,n,"Q762")}};
