let titulo="";SelectPersonaje2="",botonActivo=!1;const headers={Accept:"application/sparql-results+json"};function Comenzar(){const e=document.getElementById("maximoResultados").value,t=document.getElementById("maxIterations").value;Select="Forward",SelectPersonaje="Q19943",Inicial=!0,fectDatos(e,t,Select,SelectPersonaje)}function fectDatos(e,t,n,a){return fetch("https://query.wikidata.org/sparql?query="+encodeURIComponent(`PREFIX gas: <http://www.bigdata.com/rdf/gas#>\nSELECT ?item ?itemLabel ?linkTo ?depth ?comment (SAMPLE (?pic) AS ?unica_pic) (SAMPLE (?EjemfechaNaci) AS ?fechaNaci) (SAMPLE (?Ejemfechafalle) AS ?fechafalle)\nWHERE\n{\n  SERVICE gas:service {\n    gas:program gas:gasClass "com.bigdata.rdf.graph.analytics.SSSP" ;\n                gas:in wd:${a} ;\n                gas:traversalDirection "${n}" ;\n                gas:out ?item ;\n                gas:out1 ?depth ;\n                gas:maxIterations ${t} ;\n                gas:linkType wdt:P40 ;\n              #  gas:linkType1 wdt:P22 .\n  }\n  OPTIONAL { ?item wdt:P40 ?linkTo.}\n   #  OPTIONAL { ?item wdt:P22 ?linkTo1 }\n    OPTIONAL { ?item wdt:P18 ?pic.}\n   OPTIONAL { ?item  p:P18 [ps:P18  ?pic; wikibase:rank wikibase:PreferredRank] }\n   OPTIONAL { ?item wdt:P569 ?EjemfechaNaci }\n      OPTIONAL { ?item wdt:P570 ?Ejemfechafalle }\nOPTIONAL { ?item schema:description ?comment.\n             FILTER (lang(?comment) = 'es').}\n  SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],es,en,ar,be,bg,bn,ca,cs,da,de,el,fr,et,fa,fi,he,hi,hu,hy,id,it,ja,jv,ko,nb,nl,eo,pa,pl,pt,ro,ru,sh,sk,sr,sv,sw,te,th,tr,uk,yue,vec,vi,zh". }\n}GROUP BY ?item ?itemLabel ?linkTo ?unica_pic ?depth ?comment ?fechaNaci ?fechaFalle\nORDER BY ?depth\nLIMIT ${e}`),{headers:headers}).then((e=>e.json())).then((e=>mostrarDatos(e)))}function errorFunction(){document.getElementById("div").innerHTML="No hemos encontrado lo que buscabas, prueba otra palabra"}function mostrarDatos(e){document.getElementById("timeline").innerHTML="";const t=document.getElementById("supDerecha");t.innerHTML="";const n=document.getElementById("descen-progenitores").value;if("Descendientes"==n){if(document.getElementById("titulo").textContent="Descendientes de "+e.results.bindings[0].itemLabel.value,e.results.bindings[0].unica_pic){const n=document.createElement("img"),a=e.results.bindings[0].unica_pic.value.replace("File:","Special:FilePath/")+"?width=50";n.setAttribute("src",a),t.appendChild(n)}if(e.results.bindings[0].comment){let t=document.getElementById("supDerecha");const n=document.createElement("p");n.textContent=e.results.bindings[0].comment.value,t.appendChild(n)}}if("Progenitores"==n){if(document.getElementById("titulo").textContent="Ascendientes de "+e.results.bindings[0].itemLabel.value,e.results.bindings[0].unica_pic){const n=document.createElement("img"),a=e.results.bindings[0].unica_pic.value.replace("File:","Special:FilePath/")+"?width=50";n.setAttribute("src",a),t.appendChild(n)}if(e.results.bindings[0].comment){let t=document.getElementById("supDerecha");const n=document.createElement("p");n.textContent=e.results.bindings[0].comment.value,t.appendChild(n)}}if(null==e.results.bindings[0]){document.getElementById("div").innerHTML="No hemos encontrado lo que buscabas, prueba otra palabra"}function a(e){return e=(e=(e=e.replace(/^(?![+-])/,"+")).replace(/^([+-]?)(\d{1,5}\b)/,(function(e,t,n){return t+("00000"+n).slice(-6)}))).replace(/Z$/,"")}nodes=[],e.results.bindings.forEach(((e,t)=>{e.unica_pic&&e.comment?nodes.push({id:e.item.value,label:e.itemLabel.value,color:"#fcf3f2",shape:"circularImage",image:e.unica_pic.value.replace("File:","Special:FilePath/")+"?width=100",title:e.comment.value+"  -Doble click para seleccionar este personaje-"}):e.unica_pic?nodes.push({id:e.item.value,label:e.itemLabel.value,color:"#fcf3f2",shape:"circularImage",image:e.unica_pic.value.replace("File:","Special:FilePath/")+"?width=100",title:e.itemLabel.value+"  -Doble click para seleccionar este personaje-"}):e.comment?nodes.push({id:e.item.value,label:e.itemLabel.value,color:"#fcf3f2"}):nodes.push({id:e.item.value,label:e.itemLabel.value,color:"#fcf3f2",title:e.itemLabel.value+"  -Doble click para seleccionar este personaje-"})}));let i=new Set(nodes.map(JSON.stringify)),o=Array.from(i).map(JSON.parse);c=[],e.results.bindings.forEach(((e,t)=>{e.linkTo&&c.push({from:e.item.value,to:e.linkTo.value,color:"#949191",arrows:"to",label:"Descendiente"})}));var c=new vis.DataSet(c),l=document.getElementById("mynetwork"),s={nodes:o,edges:c},r={edges:{arrows:{to:{scaleFactor:.6}}},layout:{hierarchical:{direction:directionInput.value,enabled:jerarquia,levelSeparation:250,nodeSpacing:100,treeSpacing:200,blockShifting:!0,edgeMinimization:!0,parentCentralization:!0,sortMethod:"directed",shakeTowards:"leaves"}},nodes:{shape:"ellipse"}};new vis.Network(l,s,r).on("doubleClick",(function(e){const t=document.getElementById("maximoResultados").value,n=document.getElementById("maxIterations").value,a=document.getElementById("descen-progenitores").value;Select="",Select="Descendientes"==a?"Forward":"Reverse",SelectPersonaje2="",fectDatos(t,n,Select,e.nodes[0].slice(31)),SelectPersonaje2=e.nodes[0].slice(31),botonActivo=!1})),items2=[],e.results.bindings.forEach(((e,t)=>{e.fechaNaci&&"http"===e.fechaNaci.value.slice(0,4)||(e.unica_pic&&e.fechaNaci?items2.push({id:e.item.value,content:e.itemLabel.value+'</br><img src="'+e.unica_pic.value.replace("File:","Special:FilePath/")+'?width=50"/></br>'+e.fechaNaci.value.slice(0,5).replace(/[^0-9]$/,""),start:a(e.fechaNaci.value)}):e.fechaNaci&&items2.push({id:e.item.value,content:e.itemLabel.value+"</br>"+e.fechaNaci.value.slice(0,5).replace(/[^0-9]$/,""),start:a(e.fechaNaci.value)}))}));let d=new Set(items2.map(JSON.stringify));montar(Array.from(d).map(JSON.parse),r={minHeight:"400px",maxHeight:"500px",orientation:{axis:"both",item:"top"},align:"auto",stack:!0})}function montar(e,t){var n=document.getElementById("timeline");new vis.Timeline(n,e,t)}document.getElementById("botonBusqueda").addEventListener("click",(()=>{const e=document.getElementById("maximoResultados").value,t=document.getElementById("maxIterations").value,n=document.getElementById("descen-progenitores").value;botonActivo=!0,Inicial=!1;let a="";a="Descendientes"==n?"Forward":"Reverse";const i=document.getElementById("tipos").value;let o="Q19943";"Juan_Carlos_I"==i?o="Q19943":"Alfonso_X"==i?o="Q47595":"Genghis_Khan"==i?o="Q720":"Isabel_I_de_Castilla"==i?o="Q45859":"Enrique_VIII_de_Inglaterra"==i?o="Q38370":"Augusto"==i?o="Q1405":"Amenofis_III"==i?o="Q42606":"Emperador_Hirohito"==i?o="Q34479":"Ptolomeo_I"==i?o="Q168261":"Cleopatra"==i?o="Q635":"Luis_XIV_de_Francia"==i?o="Q7742":"Diego_Velázquez"==i?o="Q297":"Adriano"==i?o="Q1427":"Blanca_de_Castilla"==i?o="Q353":"Rodrigo_Díaz_de_Vivar"==i?o="Q43958":"Ragnar_Lothbrok"==i?o="Q314492":"Adan"==i&&(o="Q70899"),o&&fectDatos(e,t,a,o),document.getElementById("nombreEntrada").value=o}));var directionInput=document.getElementById("direction"),btnUD=document.getElementById("btn-UD");btnUD.onclick=function(){directionInput.value="UD",jerarquia=!0;SelectPersonaje2;const e=document.getElementById("maximoResultados").value,t=document.getElementById("maxIterations").value;let n="";if(n="Descendientes"==document.getElementById("descen-progenitores").value?"Forward":"Reverse",1==botonActivo){fectDatos(e,t,n,document.getElementById("nombreEntrada").value)}else if(0==botonActivo){fectDatos(e,t,n,SelectPersonaje2)}if(1==Inicial){fectDatos(e,t,n,"Q19943")}};var btnDU=document.getElementById("btn-DU");btnDU.onclick=function(){directionInput.value="DU",jerarquia=!0;SelectPersonaje2;const e=document.getElementById("maximoResultados").value,t=document.getElementById("maxIterations").value;let n="";if(n="Descendientes"==document.getElementById("descen-progenitores").value?"Forward":"Reverse",1==botonActivo){fectDatos(e,t,n,document.getElementById("nombreEntrada").value)}else if(0==botonActivo){fectDatos(e,t,n,SelectPersonaje2)}if(1==Inicial){fectDatos(e,t,n,"Q19943")}};var btnLR=document.getElementById("btn-LR");btnLR.onclick=function(){directionInput.value="LR",jerarquia=!0;SelectPersonaje2;const e=document.getElementById("maximoResultados").value,t=document.getElementById("maxIterations").value;let n="";if(n="Descendientes"==document.getElementById("descen-progenitores").value?"Forward":"Reverse",1==botonActivo){fectDatos(e,t,n,document.getElementById("nombreEntrada").value)}else if(0==botonActivo){fectDatos(e,t,n,SelectPersonaje2)}if(1==Inicial){fectDatos(e,t,n,"Q19943")}};var btnRL=document.getElementById("btn-RL");btnRL.onclick=function(){directionInput.value="RL",jerarquia=!0;SelectPersonaje2;const e=document.getElementById("maximoResultados").value,t=document.getElementById("maxIterations").value;document.getElementById("descen-progenitores").value;let n="";if(n="Descendientes"==document.getElementById("descen-progenitores").value?"Forward":"Reverse",1==botonActivo){fectDatos(e,t,n,document.getElementById("nombreEntrada").value)}else if(0==botonActivo){fectDatos(e,t,n,SelectPersonaje2)}if(1==Inicial){fectDatos(e,t,n,"Q19943")}};var jerarquia=!0;directionInput.value="UD";var btnJER=document.getElementById("btn-Jerarq");btnJER.onclick=function(){jerarquia=!1;SelectPersonaje2;const e=document.getElementById("maximoResultados").value,t=document.getElementById("maxIterations").value;let n="";if(n="Descendientes"==document.getElementById("descen-progenitores").value?"Forward":"Reverse",1==botonActivo){fectDatos(e,t,n,document.getElementById("nombreEntrada").value)}else if(0==botonActivo){fectDatos(e,t,n,SelectPersonaje2)}if(1==Inicial){fectDatos(e,t,n,"Q19943")}};
